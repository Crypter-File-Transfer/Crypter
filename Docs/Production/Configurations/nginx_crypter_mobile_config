server {
  listen         80 default_server;
  listen         [::]:80 default_server;

  server_name    "";
  return         444;
}

server {
  # do not listen to port 80 here
  listen                         443 ssl http2;
  listen                         [::]:443 ssl http2;
  server_name                    m.crypter.dev;

  access_log                     /var/log/nginx/crypter.dev.access.log;
  error_log                      /var/log/nginx/crypter.dev.error.log;
  ssl_session_timeout            10m;
  ssl_protocols                  TLSv1.1 TLSv1.2;
  ssl_prefer_server_ciphers      on;
  ssl_buffer_size                8k;

  client_max_body_size           5M;

  root                           /var/www/Crypter.Web.Mobile/wwwroot;

  location / {

    index index.html;
    error_page 404 = /;

    gzip_types      text/plain application/xml application/x-msdownload application/json application/wasm application/octet-stream;
    gzip_proxied    no-cache no-store private expired auth;
    gzip_min_length 1000;

    location /_framework/ {
      include /etc/nginx/mime.types; # includes an entry for application/wasm
    }
  }
}

server {
  listen        80;
  listen        [::]:80;

  server_name   m.crypter.dev;
  return        301 https://m.crypter.dev$request_uri;
}
